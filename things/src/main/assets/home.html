<!--
  ~  Copyright 2017 Keval Patel.
  ~
  ~  Licensed under the Apache License, Version 2.0 (the "License");
  ~  you may not use this file except in compliance with the License.
  ~  You may obtain a copy of the License at
  ~
  ~   http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~  Unless required by applicable law or agreed to in writing, software
  ~  distributed under the License is distributed on an "AS IS" BASIS,
  ~  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~  See the License for the specific language governing permissions and
  ~  limitations under the License.
  -->

<html lang="en">
<head>
    <title>Robot Control</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            color: #555;
            background-color: #eee;
            padding-right: 50px;
            min-width: 900px;
        }
        .container {
            margin: 10px;
            border: 0px solid #555;
            display: table;
            width:100%;
            table-layout: fixed;
            text-align: center;
       }
        .video-container {
            box-sizing: border-box;
            margin-top: -35px;
        }

        div.video-player  {
            position: relative;
            margin-top: 15px;
            margin-left: 30px;
        }
        img.video-player  {
            position: absolute;
            margin-top: 35px;
            width: 640px;
            height: 360px;
        }
        canvas.video-player {
            background: black;
            position: absolute;
            margin-top: 35px;
            width: 480px;
            height: 290px;
            left: 68px;
            top: 35px;
        }

        .video-controls {
            text-align: center;
            margin-top: 400px;
        }

        .span-info {
            color: #555555;
            font-size: small;
            margin-top: 2px;
            margin-bottom: 2px;
        }

    </style>
    <script>
        console.log("robotWebUi.js : server IP= "+document.location.host);
        var sock = new WebSocket('ws://' + document.location.host, "protocolOne");

        sock.onopen = function (event) {
             console.log("I am connected to server.....");
            //document.getElementById("connection").value = 'CONNECTED';
        };

        sock.onmessage = function (event) {
            console.log("on message" + event.data);
            document.getElementById('IMG').setAttribute( 'src', event.data );
        }

        sock.onerror = function (error) {
            console.log('WebSocket Error',  error);
        };

        function send(message) {
            console.log('WebSocket try to send',  message);
            sock.send(message);
        };

        document.onkeydown = checkKey;
        document.onkeyup = stopRobot;

        var isCommandSent = false;
        function checkKey(e) {
                if (!isCommandSent){
                    isCommandSent = true;
                    e = e || window.event;
                    switch (event.keyCode || event.which) {
                        case 87:
                        case 38:
                             // up arrow
                            send("forward");
                            break;
                        case 83:
                        case 40:
                             // down arrow
                           send("reverse");
                            break;
                        case 65:
                        case 37:
                              // left arrow
                            send("left");
                            break;
                        case 68:
                        case 39:
                             send("right");
                            break;
                    }
                }
        }

        function stopRobot(e) {
            if (isCommandSent){
                send("stop");
                isCommandSent = false;
            }
        }
    </script>
</head>
<body>
<H1>Robocar Controller</H1>
<div id="all">
    <div class="container">
        <input type="button" value="FORWARD" onclick="send('forward')"/>
    </div>
    <div class="container">
        <input type="button" style="margin-right:25" value="LEFT" onclick="send('left')"/>
        <input type="button" value="RIGHT" onclick="send('right')"/>
    </div>
    <div class="container">
        <input type="button" value="BACKWARD" onclick="send('reverse')"/>
    </div>
    <div class="container">
        <input type="button" value="TAKE A SHOT" onclick="send('capture')"/>
    </div>
    <div class="container">
        <label class="item"><img id="IMG" src=""/></label>
    </div>
    <!--<div class="video-container">-->
    <!--<div class="video-player">-->
    <!--<img src="img/phone.png" class="video-player" />-->
    <!--<canvas width="640px" height="360px" class="video-player" id="videoPlayer"></canvas>-->
    <!--</div>-->
    <!--</div>-->
</div>
</body>
</html>