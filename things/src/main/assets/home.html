<!--
  ~  Copyright 2017 Keval Patel.
  ~
  ~  Licensed under the Apache License, Version 2.0 (the "License");
  ~  you may not use this file except in compliance with the License.
  ~  You may obtain a copy of the License at
  ~
  ~   http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~  Unless required by applicable law or agreed to in writing, software
  ~  distributed under the License is distributed on an "AS IS" BASIS,
  ~  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~  See the License for the specific language governing permissions and
  ~  limitations under the License.
  -->

<html lang="en">
<head>
    <title>Robot Control</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            color: #555;
            background-color: #eee;
            padding-right: 50px;
            min-width: 900px;
        }
        .container {
            margin: 10px;
            border: 0px solid #555;
            display: table;
            width:100%;
            table-layout: fixed;
            text-align: center;
       }


    </style>
    <script>
        document.onkeydown = checkKey;
        document.onkeyup = stopRobot;

        var baseUrl = "http://192.168.0.106:8080/command?cmd="
        var isCommandSent = false

        var HttpClient = function() {
            this.get = function(aUrl, aCallback) {
                var anHttpRequest = new XMLHttpRequest();
                anHttpRequest.onreadystatechange = function() {
                    if (anHttpRequest.readyState == 4 && anHttpRequest.status == 200)
                        aCallback(anHttpRequest.responseText);
                }

                anHttpRequest.open("GET", aUrl, true);
                anHttpRequest.send(null);
            }
        }

        function checkKey(e) {
            if (!isCommandSent) {
                isCommandSent = true
                e = e || window.event;
                switch (event.keyCode || event.which) {
                    case 87:
                    case 38:
                         // up arrow
                        var commandStr = baseUrl.concat("forward");
                        httpGet(commandStr)
                        break;
                    case 83:
                    case 40:
                         // down arrow
                        var commandStr = baseUrl.concat("reverse");
                        httpGet(commandStr)
                        break;
                    case 65:
                    case 37:
                          // left arrow
                        var commandStr = baseUrl.concat("left");
                        httpGet(commandStr)
                        break;
                    case 68:
                    case 39:
                         var commandStr = baseUrl.concat("right");
                            httpGet(commandStr)
                        break;
                }
            }
        }

        function stopRobot(e) {
            var commandStr = baseUrl.concat("stop");
            httpGet(commandStr)
            isCommandSent = false
        }

        function httpGet(theUrl) {
            console.log(theUrl);
            var client = new HttpClient();
            client.get(theUrl, function(response) {
                console.log(response);
            });
        }

        function send(message) {
            var commandStr = baseUrl.concat(message);
            httpGet(commandStr)
        };

    </script>
</head>
<body>
<H1>Robocar Controller</H1>
<div id="all">
    <div class="container">
        <input type="button" value="FORWARD" onclick="send('forward')"/>
    </div>
    <div class="container">
        <input type="button" style="margin-right:25" value="LEFT" onclick="send('left')"/>
        <input type="button" value="RIGHT" onclick="send('right')"/>
    </div>
    <div class="container">
        <input type="button" value="BACKWARD" onclick="send('reverse')"/>
    </div>
    <div class="container">
        <label class="item"><img id="IMG" src=""/></label>
        <input type="button" value="TAKE A SHOT" onclick="send('capture')"/>
    </div>

</div>
</body>
</html>